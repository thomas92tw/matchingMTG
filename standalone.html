<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智能會議調度器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .draggable { cursor: grab; }
    .dragging { opacity: 0.7; cursor: grabbing; }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, createContext, useContext } = React;

    // Constants
    const APP_TITLE = "Intelligent Meeting Scheduler";
    const MAX_BUYERS_PER_BLOCK = 20;
    const NUM_PRIMARY_PREFERRED_SELLERS = 6;
    const NUM_BACKUP_PREFERRED_SELLERS = 4;
    const TOTAL_PREFERRED_SELLERS = NUM_PRIMARY_PREFERRED_SELLERS + NUM_BACKUP_PREFERRED_SELLERS;

    const INITIAL_SESSION_SETTINGS = {
      count: 6,
      durationMinutes: 30,
      breakMinutes: 5,
      morningStartTime: "09:30",
      afternoonStartTime: "13:30",
    };

    const generateId = () => `id_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

    // Auth Context
    const AuthContext = createContext();

    const AuthProvider = ({ children }) => {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [currentView, setCurrentView] = useState('search');

      useEffect(() => {
        const authStatus = sessionStorage.getItem('adminAuthenticated');
        if (authStatus === 'true') {
          setIsAuthenticated(true);
        }
      }, []);

      const login = (password) => {
        if (password === 'admin123') {
          setIsAuthenticated(true);
          sessionStorage.setItem('adminAuthenticated', 'true');
          setCurrentView('admin');
          return true;
        }
        return false;
      };

      const logout = () => {
        setIsAuthenticated(false);
        sessionStorage.removeItem('adminAuthenticated');
        setCurrentView('search');
      };

      const goToAdmin = () => {
        if (isAuthenticated) {
          setCurrentView('admin');
        } else {
          setCurrentView('login');
        }
      };

      const goToSearch = () => {
        setCurrentView('search');
      };

      return (
        <AuthContext.Provider value={{ 
          isAuthenticated, 
          login, 
          logout, 
          currentView, 
          goToAdmin, 
          goToSearch, 
          setCurrentView 
        }}>
          {children}
        </AuthContext.Provider>
      );
    };

    const useAuth = () => {
      const context = useContext(AuthContext);
      if (!context) {
        throw new Error('useAuth must be used within an AuthProvider');
      }
      return context;
    };

    // Utility Functions
    const parseTimeToMinutes = (time) => {
      const [hours, minutes] = time.split(':').map(Number);
      return hours * 60 + minutes;
    };

    const calculateSessions = (settings, blockType) => {
      const sessions = [];
      const startTimeStr = blockType === 'morning' ? settings.morningStartTime : settings.afternoonStartTime;
      let currentTime = parseTimeToMinutes(startTimeStr);
      const prefix = blockType === 'morning' ? 'M' : 'A';

      for (let i = 0; i < settings.count; i++) {
        const startTimeMinutes = currentTime;
        const endTimeMinutes = currentTime + settings.durationMinutes;

        const formatTime = (totalMinutes) => {
          const hours = Math.floor(totalMinutes / 60).toString().padStart(2, '0');
          const minutes = (totalMinutes % 60).toString().padStart(2, '0');
          return `${hours}:${minutes}`;
        };

        sessions.push({
          id: `${prefix}_s${i + 1}`,
          name: `${prefix}-Session ${i + 1}`,
          startTime: formatTime(startTimeMinutes),
          endTime: formatTime(endTimeMinutes),
          block: blockType,
        });

        currentTime = endTimeMinutes + settings.breakMinutes;
      }
      return sessions;
    };

    // Components
    const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false, ...props }) => {
      const baseStyles = "px-4 py-2 rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2";
      const variants = {
        primary: "bg-gray-800 text-white hover:bg-gray-700 focus:ring-gray-500",
        secondary: "bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-500",
        danger: "bg-red-600 text-white hover:bg-red-700 focus:ring-red-500"
      };
      
      return (
        <button
          onClick={onClick}
          disabled={disabled}
          className={`${baseStyles} ${variants[variant]} ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`}
          {...props}
        >
          {children}
        </button>
      );
    };

    const TextInput = ({ value, onChange, placeholder, type = 'text', className = '', ...props }) => {
      return (
        <input
          type={type}
          value={value}
          onChange={onChange}
          placeholder={placeholder}
          className={`block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-gray-600 sm:text-sm sm:leading-6 ${className}`}
          {...props}
        />
      );
    };

    // Login Component
    const AdminLogin = () => {
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      const { login, goToSearch } = useAuth();

      const handleSubmit = (e) => {
        e.preventDefault();
        setError('');
        
        if (login(password)) {
          // Successfully logged in
        } else {
          setError('密碼錯誤，請重試');
          setPassword('');
        }
      };

      return (
        <div className="min-h-screen bg-gray-100 flex items-center justify-center py-12 px-4">
          <div className="max-w-md w-full space-y-8">
            <div>
              <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900">
                管理員登入
              </h2>
              <p className="mt-2 text-center text-sm text-gray-600">
                請輸入管理員密碼以存取管理介面
              </p>
            </div>
            <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
              <div>
                <TextInput
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="管理員密碼"
                  required
                />
              </div>

              {error && (
                <div className="rounded-md bg-red-50 p-4">
                  <div className="text-sm text-red-700">{error}</div>
                </div>
              )}

              <div>
                <Button type="submit" className="w-full">
                  登入管理介面
                </Button>
              </div>
              
              <div className="text-center">
                <button 
                  type="button"
                  onClick={goToSearch}
                  className="text-sm text-gray-600 hover:text-gray-900 underline"
                >
                  回到使用者查詢介面
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    // Search Page Component
    const UserSearchPage = () => {
      const [searchTerm, setSearchTerm] = useState('');
      const [suggestions, setSuggestions] = useState([]);
      const [showSuggestions, setShowSuggestions] = useState(false);
      const { goToAdmin } = useAuth();

      // Sample data for demo
      const sampleSellers = [
        { id: '1', name: '張三' },
        { id: '2', name: '李四' },
        { id: '3', name: '王五' },
        { id: '4', name: 'John Smith' },
        { id: '5', name: 'Mary Johnson' }
      ];

      const sampleBuyers = [
        { id: '1', name: '台灣科技公司', country: 'Taiwan', sessionBlock: 'morning' },
        { id: '2', name: 'US Tech Corp', country: 'USA', sessionBlock: 'afternoon' }
      ];

      const sampleSchedule = {
        '1': { 'M_s1': '1', 'M_s2': '2' },
        '2': { 'A_s1': '3', 'A_s2': '4' }
      };

      const sampleSessions = [
        { id: 'M_s1', name: 'M-Session 1', startTime: '09:30', endTime: '10:00', block: 'morning' },
        { id: 'M_s2', name: 'M-Session 2', startTime: '10:05', endTime: '10:35', block: 'morning' },
        { id: 'A_s1', name: 'A-Session 1', startTime: '13:30', endTime: '14:00', block: 'afternoon' },
        { id: 'A_s2', name: 'A-Session 2', startTime: '14:05', endTime: '14:35', block: 'afternoon' }
      ];

      const handleSearchChange = (e) => {
        const value = e.target.value;
        setSearchTerm(value);
        
        if (value.trim()) {
          const filtered = sampleSellers.filter(seller =>
            seller.name.toLowerCase().includes(value.toLowerCase())
          );
          setSuggestions(filtered);
          setShowSuggestions(true);
        } else {
          setSuggestions([]);
          setShowSuggestions(false);
        }
      };

      const selectSeller = (seller) => {
        setSearchTerm(seller.name);
        setShowSuggestions(false);
      };

      const getSellerMeetings = () => {
        const selectedSeller = sampleSellers.find(s => s.name === searchTerm);
        if (!selectedSeller) return [];

        const meetings = [];
        Object.entries(sampleSchedule).forEach(([buyerId, sessions]) => {
          Object.entries(sessions).forEach(([sessionId, sellerId]) => {
            if (sellerId === selectedSeller.id) {
              const buyer = sampleBuyers.find(b => b.id === buyerId);
              const session = sampleSessions.find(s => s.id === sessionId);
              if (buyer && session) {
                meetings.push({ buyer, session });
              }
            }
          });
        });
        return meetings;
      };

      const meetings = getSellerMeetings();

      return (
        <div className="min-h-screen bg-gray-100 flex flex-col items-center py-8 px-4">
          <header className="mb-8 text-center">
            <h1 className="text-5xl font-extrabold text-gray-800">
              {APP_TITLE}
            </h1>
            <p className="mt-2 text-gray-600">
              賣家會議時間查詢系統
            </p>
            <div className="mt-4">
              <button 
                onClick={goToAdmin}
                className="text-sm text-gray-600 hover:text-gray-900 underline"
              >
                管理員入口
              </button>
            </div>
          </header>

          <main className="w-full max-w-4xl">
            <div className="bg-white rounded-lg shadow-lg p-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-6">賣家會議查詢</h2>
              
              <div className="relative mb-6">
                <TextInput
                  value={searchTerm}
                  onChange={handleSearchChange}
                  placeholder="請輸入賣家姓名進行搜尋..."
                  className="text-lg py-3"
                />
                
                {showSuggestions && suggestions.length > 0 && (
                  <div className="absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-md shadow-lg z-10 mt-1">
                    {suggestions.map(seller => (
                      <button
                        key={seller.id}
                        onClick={() => selectSeller(seller)}
                        className="w-full text-left px-4 py-2 hover:bg-gray-100 focus:bg-gray-100"
                      >
                        {seller.name}
                      </button>
                    ))}
                  </div>
                )}
              </div>

              {meetings.length > 0 && (
                <div>
                  <h3 className="text-lg font-semibold mb-4">
                    {searchTerm} 的會議安排
                  </h3>
                  <div className="grid gap-4">
                    {meetings.map((meeting, index) => (
                      <div key={index} className="border border-gray-200 rounded-lg p-4">
                        <div className="flex justify-between items-start">
                          <div>
                            <h4 className="font-medium text-gray-800">
                              {meeting.session.name}
                            </h4>
                            <p className="text-sm text-gray-600">
                              {meeting.session.startTime} - {meeting.session.endTime}
                            </p>
                          </div>
                          <div className="text-right">
                            <p className="font-medium text-gray-800">
                              {meeting.buyer.name}
                            </p>
                            <p className="text-sm text-gray-600">
                              {meeting.buyer.country}
                            </p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {searchTerm && meetings.length === 0 && (
                <div className="text-center py-8">
                  <p className="text-gray-500">未找到相關會議安排</p>
                </div>
              )}

              {!searchTerm && (
                <div className="text-center py-8">
                  <p className="text-gray-500">請輸入賣家姓名開始搜尋</p>
                  <p className="text-sm text-gray-400 mt-2">
                    演示數據：張三、李四、王五、John Smith、Mary Johnson
                  </p>
                </div>
              )}
            </div>
          </main>

          <footer className="mt-12 text-center text-gray-500 text-sm">
            <p>&copy; 2025 新興市場領航計畫 Intelligent Meeting Scheduler</p>
          </footer>
        </div>
      );
    };

    // Admin Panel Component
    const AdminPanel = () => {
      const { logout, goToSearch } = useAuth();
      const [buyers, setBuyers] = useState([
        { id: '1', name: '台灣科技公司', country: 'Taiwan', sessionBlock: 'morning' },
        { id: '2', name: 'US Tech Corp', country: 'USA', sessionBlock: 'afternoon' }
      ]);
      const [sellers, setSellers] = useState([
        { id: '1', name: '張三' },
        { id: '2', name: '李四' },
        { id: '3', name: '王五' },
        { id: '4', name: 'John Smith' },
        { id: '5', name: 'Mary Johnson' }
      ]);

      return (
        <div className="min-h-screen bg-gray-100 flex flex-col items-center py-8 px-4">
          <header className="mb-8 text-center w-full max-w-7xl">
            <div className="flex justify-between items-center mb-6">
              <h1 className="text-4xl font-extrabold text-gray-800 flex-1">
                {APP_TITLE} - 管理員介面
              </h1>
              <Button onClick={logout} variant="secondary">
                登出
              </Button>
            </div>
            <div className="text-center">
              <button 
                onClick={goToSearch}
                className="text-sm text-gray-600 hover:text-gray-900 underline"
              >
                前往使用者查詢介面
              </button>
            </div>
          </header>

          <main className="w-full max-w-7xl">
            <div className="bg-white rounded-lg shadow-lg p-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-6">管理控制台</h2>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                {/* Buyers Section */}
                <div className="border border-gray-200 rounded-lg p-4">
                  <h3 className="text-lg font-semibold mb-4">買家管理</h3>
                  <div className="space-y-2">
                    {buyers.map(buyer => (
                      <div key={buyer.id} className="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span className="text-sm">
                          {buyer.name} ({buyer.country}, {buyer.sessionBlock})
                        </span>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Sellers Section */}
                <div className="border border-gray-200 rounded-lg p-4">
                  <h3 className="text-lg font-semibold mb-4">賣家管理</h3>
                  <div className="space-y-2">
                    {sellers.map(seller => (
                      <div key={seller.id} className="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span className="text-sm">{seller.name}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Features */}
              <div className="bg-blue-50 p-6 rounded-lg">
                <h3 className="text-lg font-semibold text-blue-800 mb-3">
                  管理功能
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="bg-white p-4 rounded border">
                    <h4 className="font-medium text-gray-800">智能排程</h4>
                    <p className="text-sm text-gray-600 mt-1">自動安排最佳會議時間</p>
                  </div>
                  <div className="bg-white p-4 rounded border">
                    <h4 className="font-medium text-gray-800">拖拽編輯</h4>
                    <p className="text-sm text-gray-600 mt-1">直觀的排程編輯介面</p>
                  </div>
                  <div className="bg-white p-4 rounded border">
                    <h4 className="font-medium text-gray-800">CSV 匯出</h4>
                    <p className="text-sm text-gray-600 mt-1">匯出會議安排表格</p>
                  </div>
                </div>
              </div>

              <div className="mt-6 text-center text-sm text-gray-500">
                <p>這是演示版本，完整功能請在開發服務器中測試</p>
              </div>
            </div>
          </main>

          <footer className="mt-12 text-center text-gray-500 text-sm">
            <p>&copy; 2025 新興市場領航計畫 Intelligent Meeting Scheduler</p>
          </footer>
        </div>
      );
    };

    // Main App Component
    const App = () => {
      const { currentView } = useAuth();

      const renderView = () => {
        switch (currentView) {
          case 'admin':
            return <AdminPanel />;
          case 'login':
            return <AdminLogin />;
          case 'search':
          default:
            return <UserSearchPage />;
        }
      };

      return (
        <div>
          {renderView()}
        </div>
      );
    };

    // Render the app
    const AppWithProvider = () => (
      <AuthProvider>
        <App />
      </AuthProvider>
    );

    ReactDOM.render(<AppWithProvider />, document.getElementById('root'));
  </script>
</body>
</html>